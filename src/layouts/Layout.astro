---
import "../styles/global.css";
import { useTranslations } from "../i18n/utils";
import { ClientRouter } from "astro:transitions";

interface Props {
  title: string;
  lang?: "es" | "en";
}

const { title, lang = "es" } = Astro.props;
const t = useTranslations(lang);
---

<!doctype html>
<html lang={lang} data-theme="dark" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={t('meta.description')} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title}</title>
    <ClientRouter />
    
    <!-- Google Analytics (GA4) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9YLWS6TY5V"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-9YLWS6TY5V');
    </script>

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json" is:inline set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Ivan Cruz",
      "url": "https://web-portfolio-f.mgdc.site",
      "image": "https://web-portfolio-f.mgdc.site/favicon.svg",
      "sameAs": [
        "https://github.com/Ivandv19"
      ],
      "jobTitle": t('footer.role'),
      "description": t('meta.description'),
      "knowsAbout": [
        "Frontend Development",
        "React",
        "Astro",
        "Cloud Hosting",
        "Infrastructure"
      ],
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": t('services.title'),
        "itemListElement": [
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": t('services.landing.title'),
              "description": t('services.landing.desc')
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": t('services.infra.title'),
              "description": t('services.infra.desc')
            }
          }
        ]
      }
    })}>
    </script>
  </head>
  <body class="flex flex-col min-h-screen bg-base-100 antialiased">
    
    <header class="navbar bg-base-100/80 backdrop-blur-md border-b border-base-content/10 sticky top-0 z-50 px-4 lg:px-8 xl:px-20">
      <div class="navbar-start">
        <div class="dropdown">
          <label tabindex="0" class="btn btn-ghost xl:hidden">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16" />
            </svg>
          </label>
          <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-200 rounded-box w-52 font-medium">
            <li><a href="#hero">{t('nav.home')}</a></li>
            <li><a href="#servicios">{t('nav.services')}</a></li>
            <li><a href="#proyectos">{t('nav.projects')}</a></li>
            <li><a href="#testimonios">{t('nav.testimonials')}</a></li>
            <li><a href="#sobre-mi">{t('nav.about')}</a></li>
            <li>
              <details>
                <summary>Language: {lang.toUpperCase()}</summary>
                <ul>
                  <li><a href="/" class={lang === 'es' ? 'active' : ''}>Español</a></li>
                  <li><a href="/en/" class={lang === 'en' ? 'active' : ''}>English</a></li>
                </ul>
              </details>
            </li>
            <li class="mt-2"><a href="#contacto" class="btn btn-primary btn-sm text-white">{t('nav.contact')}</a></li>
          </ul>
        </div>

        <a href="#hero" class="text-xl font-bold tracking-tighter">
          {t('nav.logo.text')}<span class="text-primary">{t('nav.logo.highlight')}</span>
        </a>
      </div>

      <div class="navbar-end hidden xl:flex">
        <ul class="menu menu-horizontal px-1 font-medium gap-2">
          <li><a href="#hero" class="hover:text-primary transition-colors">{t('nav.home')}</a></li>
          <li><a href="#servicios" class="hover:text-primary transition-colors">{t('nav.services')}</a></li>
          <li><a href="#proyectos" class="hover:text-primary transition-colors">{t('nav.projects')}</a></li>
          <li><a href="#testimonios" class="hover:text-primary transition-colors">{t('nav.testimonials')}</a></li>
          <li><a href="#sobre-mi" class="hover:text-primary transition-colors">{t('nav.about')}</a></li>
        </ul>

        <a href="#contacto" class="btn btn-primary btn-sm ml-4 text-white border-none px-6">
          {t('nav.contact')}
        </a>
        
        <!-- Desktop Language Selector -->
        <div class="dropdown dropdown-end ml-4">
          <div tabindex="0" role="button" class="btn btn-ghost btn-sm gap-2">
            {lang === 'es' ? 'Español' : 'English'}
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="opacity-60"
              ><path d="m6 9 6 6 6-6"></path></svg
            >
          </div>
          <ul
            tabindex="0"
            class="dropdown-content z-[1] menu p-2 shadow bg-base-200 rounded-box w-52"
          >
            <li><a href="/" class={lang === 'es' ? 'active' : ''}>Español</a></li>
            <li><a href="/en/" class={lang === 'en' ? 'active' : ''}>English</a></li>
          </ul>
        </div>
      </div>
    </header>

    <main class="flex-grow" transition:animate="fade">
      <slot />
    </main>

  
    <footer class="footer p-10 bg-neutral text-neutral-content footer-center rounded-t-[3rem] mt-20 flex flex-col md:grid">
      
    
      <nav class="flex flex-wrap justify-center gap-4 text-sm opacity-80 font-medium md:grid-flow-col">
        <a href="#hero" class="link link-hover">{t('nav.home')}</a>
        <a href="#servicios" class="link link-hover">{t('nav.services')}</a>
        <a href="#proyectos" class="link link-hover">{t('nav.projects')}</a>
        <a href="#testimonios" class="link link-hover">{t('nav.testimonials')}</a>
        <a href="#sobre-mi" class="link link-hover">{t('nav.about')}</a>
        <a href="#contacto" class="link link-hover">{t('nav.contact')}</a>
      </nav>
      
      <div class="divider divider-horizontal opacity-5 hidden md:flex"></div>
      
      <aside>
        <p class="text-xs opacity-50">
          <span set:html={t('footer.rights')} />
        </p>
        <div class="flex gap-4 mt-4 opacity-50 justify-center md:justify-start">
          <span class="text-[10px] font-black tracking-widest uppercase">{t('footer.role')}</span>
        </div>
      </aside>
    </footer>

    <script>
      const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.1
      };

      const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            observer.unobserve(entry.target);
          }
        });
      }, observerOptions);

      document.addEventListener('astro:page-load', () => {
        const hiddenElements = document.querySelectorAll('.animate-on-scroll');
        hiddenElements.forEach((el) => observer.observe(el));
      });
    </script>
  </body>
</html>